<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Criador de Builds — Wakfu PRO</title>
<link rel="stylesheet" href="css/style.css">
</head>
<body>
  <div class="header"><div class="h1">Criador de Builds — PRO</div><div class="small">Escolha elementos, equipamentos e teste builds</div></div>
  <div class="container">
    <div class="nav"><a href="index.html">Tabela</a><a href="guides.html">Guias</a><a href="builder.html">Criador de Builds</a></div>

    <div class="builder-grid">
      <div class="panel">
        <div class="select-row"><label class="small">Nome da Build:</label><input id="buildName" class="input" placeholder="Nome"/></div>
        <div class="select-row">
          <label class="small">Elemento:</label>
          <select id="element" class="input">
            <option value="Terra">Terra</option>
            <option value="Ar">Ar</option>
            <option value="Fogo">Fogo</option>
          </select>
        </div>

        <div class="small">Pontos de Atributo (50 pontos)</div>
        <div id="attrs">
          <div class="stat-row"><div>Força</div><div><input type="number" class="input attr" data-attr="Força" value="10" min="0" max="50"></div></div>
          <div class="stat-row"><div>Agilidade</div><div><input type="number" class="input attr" data-attr="Agilidade" value="10" min="0" max="50"></div></div>
          <div class="stat-row"><div>Inteligência</div><div><input type="number" class="input attr" data-attr="Inteligência" value="10" min="0" max="50"></div></div>
          <div class="stat-row"><div>Vitalidade</div><div><input type="number" class="input attr" data-attr="Vitalidade" value="10" min="0" max="50"></div></div>
          <div class="stat-row"><div>Sorte</div><div><input type="number" class="input attr" data-attr="Sorte" value="10" min="0" max="50"></div></div>
        </div>

        <div class="small" style="margin-top:10px">Equipamento (selecione até 6 peças)</div>
        <div id="gearList" style="max-height:220px;overflow:auto;margin-top:8px"></div>

        <div class="build-actions">
          <button class="btn" id="calcBtn">Gerar Build</button>
          <button class="btn" id="saveBtn">Salvar Local</button>
          <button class="btn" id="shareBtn">Copiar JSON</button>
        </div>

        <div class="legend">Pontos restantes: <span id="pointsLeft">50</span></div>
      </div>

      <div class="panel">
        <h3 style="color:var(--accent)">Resumo da Build</h3>
        <div id="summary" class="codebox">
          <div><b>Nome:</b> <span id="sName">—</span></div>
          <div><b>Elemento:</b> <span id="sElement">—</span></div>
          <div id="sAttrs"></div>
          <div id="sGear"></div>
          <div style="margin-top:8px"><b>Estimativa de dano:</b> <span id="sDmg">—</span></div>
        </div>

        <div style="margin-top:12px">
          <button class="btn" id="compareBtn">Comparar Builds</button>
          <button class="btn" id="exportJson">Exportar JSON</button>
          <button class="btn" id="importJson">Importar JSON</button>
        </div>

        <div style="margin-top:12px">
          <h4 class="small">Comparação</h4>
          <div class="compare-box">
            <div class="panel" style="flex:1">
              <div class="small">Build A</div>
              <div id="compA" class="codebox">Nenhuma</div>
            </div>
            <div class="panel" style="flex:1">
              <div class="small">Build B</div>
              <div id="compB" class="codebox">Nenhuma</div>
            </div>
          </div>
        </div>

      </div>
    </div>

    <div class="footer">✨ Criado por Azpirina ✨</div>
  </div>

<script>
const gearDB = [
  {id:'g1', name:'Armadura do Papatudo', slot:'Peito', atk:5, def:8, rarity:2},
  {id:'g2', name:'Botas de Tofu', slot:'Pés', atk:2, def:4, rarity:1},
  {id:'g3', name:'Capa de Larva', slot:'Capa', atk:3, def:6, rarity:2},
  {id:'g4', name:'Elmo Blibli', slot:'Cabeça', atk:8, def:10, rarity:3},
  {id:'g5', name:'Luvas Prespic', slot:'Mãos', atk:4, def:5, rarity:2},
  {id:'g6', name:'Anel do Crobak', slot:'Anel', atk:6, def:3, rarity:3},
  {id:'g7', name:'Amuleto Mulmouth', slot:'Amuleto', atk:10, def:2, rarity:4},
  {id:'g8', name:'Bota de Geleia', slot:'Pés', atk:3, def:6, rarity:1}
];

const gearList = document.getElementById('gearList');
gearDB.forEach(g=>{
  const div=document.createElement('div');
  div.innerHTML = `<label><input type="checkbox" class="gearchk" data-id="${g.id}"/> ${g.name} <span class="small">(${g.slot})</span></label>`;
  gearList.appendChild(div);
});

const attrs = Array.from(document.querySelectorAll('.attr'));
const pointsTotal = 50;
function pointsLeft(){
  let sum = attrs.reduce((s,el)=> s + Number(el.value || 0), 0);
  return pointsTotal - sum;
}
function updatePoints(){
  document.getElementById('pointsLeft').textContent = pointsLeft();
}
attrs.forEach(a=> a.addEventListener('input', updatePoints));
updatePoints();

function gatherBuild(){
  const name = document.getElementById('buildName').value || 'Sem nome';
  const element = document.getElementById('element').value;
  const attributes = {};
  attrs.forEach(a=> attributes[a.dataset.attr] = Number(a.value || 0));
  const gear = Array.from(document.querySelectorAll('.gearchk:checked')).map(cb=> cb.dataset.id);
  return {name, element, attributes, gear, created: new Date().toISOString()};
}

function calcEstimate(build){
  const gearAtk = build.gear.reduce((s,id)=>{
    const g = gearDB.find(x=>x.id===id); return s + (g? g.atk:0);
  },0);
  const attr = build.attributes;
  const est = Math.round(gearAtk + (attr['Força']*1.5) + (attr['Agilidade']*1.1) + (attr['Inteligência']*1.2));
  return est;
}

document.getElementById('calcBtn').addEventListener('click', ()=>{
  const build = gatherBuild();
  const dmg = calcEstimate(build);
  document.getElementById('sName').textContent = build.name;
  document.getElementById('sElement').textContent = build.element;
  const sAttrs = document.getElementById('sAttrs');
  sAttrs.innerHTML = '<b>Atributos</b><br/>' + Object.entries(build.attributes).map(a=> a[0]+': '+a[1]).join('<br/>');
  const sGear = document.getElementById('sGear');
  sGear.innerHTML = '<b>Gear</b><br/>' + (build.gear.length? build.gear.map(id=> gearDB.find(x=>x.id===id).name).join('<br/>') : 'Nenhum');
  document.getElementById('sDmg').textContent = dmg;
  saveTemp(build);
});

function saveTemp(build){
  localStorage.setItem('last_build', JSON.stringify(build));
}

document.getElementById('saveBtn').addEventListener('click', ()=> {
  const b = gatherBuild();
  let saved = JSON.parse(localStorage.getItem('saved_builds')||'[]');
  saved.push(b);
  localStorage.setItem('saved_builds', JSON.stringify(saved));
  alert('Build salva localmente!');
});

document.getElementById('shareBtn').addEventListener('click', async ()=>{
  const b = gatherBuild();
  try{
    await navigator.clipboard.writeText(JSON.stringify(b,null,2));
    alert('JSON copiado para área de transferência!');
  }catch(e){
    alert('Não foi possível copiar automaticamente. Veja o JSON abaixo:\n'+JSON.stringify(b,null,2));
  }
});

document.getElementById('exportJson').addEventListener('click', ()=>{
  const b = gatherBuild();
  const blob = new Blob([JSON.stringify(b,null,2)], {type:'application/json'});
  const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = (b.name||'build')+'.json'; a.click();
});
document.getElementById('importJson').addEventListener('click', ()=>{
  const txt = prompt('Cole o JSON da build aqui:');
  try{
    const obj = JSON.parse(txt);
    document.getElementById('buildName').value = obj.name || '';
    document.getElementById('element').value = obj.element || 'Terra';
    Object.keys(obj.attributes||{}).forEach(k=>{
      const el = document.querySelector('.attr[data-attr="'+k+'"]');
      if(el) el.value = obj.attributes[k];
    });
    document.querySelectorAll('.gearchk').forEach(cb=> cb.checked = (obj.gear||[]).includes(cb.dataset.id));
    updatePoints();
    alert('Importado');
  }catch(e){ alert('JSON inválido') }
});

document.getElementById('compareBtn').addEventListener('click', ()=>{
  const saved = JSON.parse(localStorage.getItem('saved_builds')||'[]');
  if(saved.length<2){ alert('Salve ao menos duas builds para comparar.'); return;}
  const a = saved[saved.length-2], b = saved[saved.length-1];
  document.getElementById('compA').textContent = JSON.stringify(a,null,2);
  document.getElementById('compB').textContent = JSON.stringify(b,null,2);
});

window.addEventListener('load', ()=>{
  const last = JSON.parse(localStorage.getItem('last_build')||'null');
  if(last){
    document.getElementById('buildName').value = last.name || '';
    document.getElementById('element').value = last.element || 'Terra';
    Object.entries(last.attributes||{}).forEach(([k,v])=>{
      const el = document.querySelector('.attr[data-attr="'+k+'"]');
      if(el) el.value = v;
    });
    document.querySelectorAll('.gearchk').forEach(cb=> cb.checked = (last.gear || []).includes(cb.dataset.id));
    updatePoints();
  }
});
</script>
</body>
</html>
